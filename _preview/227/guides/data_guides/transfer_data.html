

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Data Ingestion Workflows &#8212; Technical Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'guides/data_guides/transfer_data';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Working with Cloud Data" href="cloud_tools.html" />
    <link rel="prev" title="Data Guide" href="../data_guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/LEAP_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/LEAP_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    LEAP Technical Documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/ingesting_dataset.html">Data Ingestion Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/education_guide.html">Teaching Classes (Education)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/bootcamp_guide.html">Running Bootcamps</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../explanation/architecture.html">LEAP-Pangeo Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/implementation.html">LEAP-Pangeo Implementation Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/code_policy.html">LEAP-Pangeo Code Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/data_policy.html">LEAP-Pangeo Data Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/infrastructure_policy.html">LEAP-Pangeo Infrastructure Policy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../code_guide.html">Code Guide</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../data_guide.html">Data Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Data Ingestion Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="cloud_tools.html">Working with Cloud Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_workflow.html">Working outside the LEAP JupyterHub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../compute_guide.html">Compute Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm_access.html">Getting access to Cloud VMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_guide.html">Guide for Data and Computation Team Members</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vscode_remoteSSH_guide.html">Using VSCode with the Hub</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../reference/infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/membership.html">Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/education.html">Education</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_cite.html">How to cite LEAP-Pangeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/leap-stc/leap-stc.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/leap-stc/leap-stc.github.io/issues/new?title=Issue%20on%20page%20%2Fguides/data_guides/transfer_data.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/guides/data_guides/transfer_data.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Ingestion Workflows</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-a-workflow">Selecting a Workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-a-final-destination-osn-vs-gcs">Choosing a final destination - OSN vs GCS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-upload-pushing-vs-pulling">Manual Upload - “pushing” vs “pulling”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-scenarios">Transfer scenarios</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-jupyter-hub-to-gcs">Move data from Jupyter-Hub to GCS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-jupyter-hub-to-osn">Move data from Jupyter-Hub to OSN</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-laptop-hpc-to-osn">Move data from Laptop/HPC to OSN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#available-tooling">Available Tooling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#osn-pod-ingestion">OSN Pod Ingestion</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-ingestion-workflows">
<span id="guides-data-ingestion"></span><h1>Data Ingestion Workflows<a class="headerlink" href="#data-ingestion-workflows" title="Permalink to this headline">#</a></h1>
<p>This guide assumes a basic understanding of Data Ingestion and is intended to help intermediate to advanced users make intelligent long-term design decisions about they want to do with their data. If you are unfamiliar with the <em><strong>what, why, and how</strong></em> of ingestion, please first consult our <a class="reference internal" href="../../tutorials/ingesting_dataset.html#tutorials-data-ingestion"><span class="std std-ref">tutorial</span></a>. But no matter what, if anything feels confusing or daunting your first instinct should always be reaching out to the <a class="reference internal" href="../../support.html#support-data-compute-team"><span class="std std-ref">Data and Computation Team</span></a>! This page is meant to serve as a high level reference, but troubleshooting will inevitably involve the specifics of your data.</p>
<p>Based on the 3 <a class="reference internal" href="../../explanation/data_policy.html#explanation-data-policy-types"><span class="std std-ref">types of data</span></a> we host in the <a class="reference internal" href="../../explanation/architecture.html#explanation-architecture-catalog"><span class="std std-ref">The Data Catalog</span></a> there are different ways of ingesting data:</p>
<ul class="simple">
<li><p>Linking an existing (public, egress-free) ARCO dataset to the <a class="reference internal" href="../../explanation/architecture.html#explanation-architecture-catalog"><span class="std std-ref">The Data Catalog</span></a></p></li>
<li><p>Ingesting and transforming data into an ARCO copy on <a class="reference internal" href="../../reference/infrastructure.html#reference-infrastructure-buckets"><span class="std std-ref">LEAP-Pangeo Cloud Storage Buckets</span></a>.</p></li>
<li><p>(Work in Progress): Creating a <a class="reference external" href="https://virtualizarr.readthedocs.io/en/latest/">virtual zarr store</a> from existing publicly hosted legacy format data (e.g. netcdf)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You want to have a specific dataset to explore or analyze? There is a chance that somebody else at LEAP has already worked with the data! So the first thing to look for data should always be a visit to the <a class="reference internal" href="../../explanation/architecture.html#explanation-architecture-catalog"><span class="std std-ref">LEAP Data Catalog</span></a>.</p>
</div>
<p>The end result should feel indistinguishable to the user (i.e. they just copy and paste a snippet and can immediately get to work). Given the wide variety of possible workflows, there are a couple of crucial design decisions that need to be made during the ingestion process:</p>
<ol class="arabic simple">
<li><p><em>Migration strategy</em> - migration strategy depends on the load and accessibility of the data in its current form (how large is the dataset? Is it accessible online via HTTPs?). The Data and Compute team exists to help users find the best way to move their data.</p></li>
<li><p><em>Where to migrate the data</em> - LEAP current supports ingestion both to LEAP owned Google Cloud Buckets and public OSN pods.</p></li>
</ol>
<section id="selecting-a-workflow">
<span id="guides-data-ingestion-workflow-selection"></span><h2>Selecting a Workflow<a class="headerlink" href="#selecting-a-workflow" title="Permalink to this headline">#</a></h2>
<p>Thinking about some of these design choices ahead of time greatly simplifies the back and forth needed by the DCT team when the request eventually comes in. Here are some high level guidelines and things to consider for your ingestion request.</p>
<section id="choosing-a-final-destination-osn-vs-gcs">
<h3>Choosing a final destination - OSN vs GCS<a class="headerlink" href="#choosing-a-final-destination-osn-vs-gcs" title="Permalink to this headline">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There might be special situations where it is beneficial/necessary to upload data to the <a class="reference internal" href="../../reference/infrastructure.html#reference-infrastructure-buckets"><span class="std std-ref">LEAP-Pangeo Cloud Storage Buckets</span></a> but we generally encourage data ingestion to the OSN Pod due to the public access and reduced running cost. See below for instructions.</p>
</div>
<p>LEAP owns two Google Cloud buckets (<code class="docutils literal notranslate"><span class="pre">leap-persistent</span></code> and <code class="docutils literal notranslate"><span class="pre">leap-scratch</span></code>) and also has an allocation of storage on an OSN pod. We have complete access control to GCS. OSN allows s3-like cloud storage that has no egress fees, which means that you can share data with the public or outside colaborators without any cost per request.
Details on both OSN and GCS cloud storage buckets can be found in the <a class="reference internal" href="../../reference/infrastructure.html#reference-infrastructure-catalog"><span class="std std-ref">infrastructure guide</span></a>.</p>
<p>For some general guidelines on choosing:</p>
<p>GCS:
- You want to move data from your Jupyter-Hub home directory to the cloud.
- You don’t need the data to be accessed outside of the Jupyter-Hub.
- This data is a work-in-progress and might be regenerated or modified.</p>
<p>OSN:
- You want your data to be publicly accessible outside of the Jupyter-Hub.
- You need to move data from your Jupyter-Hub home directory to more persistent storage.
- You data does not fit into the Zarr model.</p>
<p>If you believe OSN better fits your data use case, please contact the data-and-compute team on slack. Then follow the instructions on <a class="reference internal" href="#guides-data-osn-pod"><span class="std std-ref">OSN Ingestion</span></a>.</p>
</section>
<section id="manual-upload-pushing-vs-pulling">
<span id="guide-data-upload-manual-deprecated"></span><h3>Manual Upload - “pushing” vs “pulling”<a class="headerlink" href="#manual-upload-pushing-vs-pulling" title="Permalink to this headline">#</a></h3>
<p>If the source data is publicly available and accessible over https, you should create a <a class="reference external" href="https://github.com/leap-stc/LEAP_template_feedstock">template feedstock</a> directly. If the data is located behind a firewall on an HPC center, the ‘pull’ based paradigm our feedstocks will not work. In this case we have an option to ‘push’ the data to a special “inbox” bucket (<code class="docutils literal notranslate"><span class="pre">'leap-pangeo-inbox'</span></code>) on the OSN Pod. This intermediate staging area makes the data accessible. From there an admin can move the data to another dedicated bucket and the data can be added to the catalog using the <a class="reference external" href="https://github.com/leap-stc/LEAP_template_feedstock">template feedstock</a>.</p>
<p>We discourage manually moving datasets to our cloud storage as much as possible since it is hard to reproduce these datasets at a future point (if e.g. the dataset maintainer has moved on to a different position) (see <a class="reference internal" href="../../explanation/data_policy.html#explanation-data-policy-reproducibility"><span class="std std-ref">Reproducibility</span></a>. We will always <a class="reference internal" href="../../explanation/code_policy.html#explanation-code-policy-dont-let-perfect-be-the-enemy-of-good"><span class="std std-ref">prioritize unblocking your work</span></a>.</p>
<!-- Fundamentally the 'pushing' of datasets relies on two components:

- Setting up permissions so that you can read/write to the [](reference.infrastructure.buckets) - Several methods to get permissions are described in [](guides.data.external.authentication).
- Initiating a data transfer from your 'local' machine (e.g. your laptop, a server, or HPC Cluster). You can check on some methods below. -->
</section>
<section id="transfer-scenarios">
<h3>Transfer scenarios<a class="headerlink" href="#transfer-scenarios" title="Permalink to this headline">#</a></h3>
<p>small: KB’s to 100’s of MB
medium: 1 to &lt;100GB</p>
<section id="move-data-from-jupyter-hub-to-gcs">
<h4>Move data from Jupyter-Hub to GCS<a class="headerlink" href="#move-data-from-jupyter-hub-to-gcs" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Data volume:</p>
<ul>
<li><p>small: <code class="docutils literal notranslate"><span class="pre">fsspec/gcsfs</span></code></p></li>
<li><p>medium: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="move-data-from-jupyter-hub-to-osn">
<h4>Move data from Jupyter-Hub to OSN<a class="headerlink" href="#move-data-from-jupyter-hub-to-osn" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>If the data volume is:</p>
<ul>
<li><p>small: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
<li><p>medium: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="move-data-from-laptop-hpc-to-osn">
<h4>Move data from Laptop/HPC to OSN<a class="headerlink" href="#move-data-from-laptop-hpc-to-osn" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>If the data volume is:</p>
<ul>
<li><p>small: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
<li><p>medium: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
<li><p>large: <code class="docutils literal notranslate"><span class="pre">rclone</span></code></p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="available-tooling">
<h2>Available Tooling<a class="headerlink" href="#available-tooling" title="Permalink to this headline">#</a></h2>
<p>Depending on the above guidelines, you will need access to different tooling. <strong>TODO</strong> <em>Expand upon available tools and how to set them up, somehow sync with <a class="reference internal" href="cloud_tools.html#guide-data-working"><span class="std std-ref">Working with Cloud Data</span></a></em></p>
<section id="osn-pod-ingestion">
<span id="guides-data-osn-pod"></span><h3>OSN Pod Ingestion<a class="headerlink" href="#osn-pod-ingestion" title="Permalink to this headline">#</a></h3>
<p><strong>Step by Step instructions</strong></p>
<ul class="simple">
<li><p>Reach out to the <a class="reference internal" href="../../support.html#support-data-compute-team"><span class="std std-ref">Data and Computation Team</span></a>. They will contact the OSN pod admin and share bucket credentials for the <code class="docutils literal notranslate"><span class="pre">'leap-pangeo-inbox'</span></code> bucket.</p></li>
<li><p>Authenticate to that bucket from a compute location that has access to your desired data and the internet. You can find instructions on how to authenticate <a class="reference internal" href="external_workflow.html#guides-data-external-authentication-config-files"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Upload the data to the ‘leap-pangeo-inbox’ in <strong>a dedicated folder</strong> (note the exact name of that folder, it is important for the later steps). How you exactly achieve the upload will depend on your preference. Some common options include:</p>
<ul>
<li><p>Open a bunch of netcdf files into xarray and use <code class="docutils literal notranslate"><span class="pre">.to_zarr(...)</span></code> to write the data to zarr.</p></li>
<li><p>Use fsspec or rclone to move an existing zarr store to the target bucket
Either way the uploaded folder should contain one or more zarr stores!
A typical workflow for the above steps might look like:</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">tutorial</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;air_temperature&quot;</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{})</span>
<span class="n">ds_processed</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># sample modifications to data</span>

<span class="c1"># define our credentials, bucket name and dataset path</span>
<span class="n">osn_bucket_name</span> <span class="o">=</span> <span class="s2">&quot;leap-pangeo-inbox&quot;</span>
<span class="n">osn_key</span> <span class="o">=</span> <span class="s2">&quot;&lt;ask DCT team&gt;&quot;</span>
<span class="n">osn_secret</span> <span class="o">=</span> <span class="s2">&quot;&lt;ask DCT team&gt;&quot;</span>
<span class="n">endpoint_url</span> <span class="o">=</span> <span class="s2">&quot;https://nyu1.osn.mghpcc.org&quot;</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">osn_bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Here we are using fsspec/s3fs to pass our OSN credentials to Zarr.</span>
<span class="c1"># Note: If you get an error like: TypeError: Unsupported type for store_like: &#39;FSMap&#39;`. It is because zarr-python does not currently support the older fsspec FSMap object style. https://github.com/zarr-developers/zarr-python/issues/2706</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
    <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="n">osn_key</span><span class="p">,</span>
    <span class="n">secret</span><span class="o">=</span><span class="n">osn_secret</span><span class="p">,</span>
    <span class="n">client_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;endpoint_url&quot;</span><span class="p">:</span> <span class="n">endpoint_url</span><span class="p">},</span>
    <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">FsspecStore</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">)</span>

<span class="n">zarr_format</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">ds_processed</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">zarr_format</span><span class="o">=</span><span class="n">zarr_format</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Note: Your data can be read anywhere, by anyone!</span>
<span class="c1"># roundtrip = xr.open_zarr(f&quot;{dataset_path}&#39;, consolidated=False)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Once you have confirmed that all data is uploaded, ask an admin to move this data to the dedicated <code class="docutils literal notranslate"><span class="pre">'leap-pangeo-manual'</span></code> bucket on the OSN pod. They can do this by running <a class="reference external" href="https://github.com/leap-stc/data-management/blob/main/.github/workflows/transfer.yaml">this github action</a>, which requires the subfolder name from above as input.</p></li>
<li><p>Once the data is moved, follow the instructions in the <a class="reference external" href="https://github.com/leap-stc/LEAP_template_feedstock">template feedstock</a> to <a class="reference external" href="https://github.com/leap-stc/LEAP_template_feedstock#linking-existing-arco-datasets">“link an existing dataset”</a> (The actual ingestion, i.e. conversion to zarr has been done manually in this case). Reach out to the <a class="reference internal" href="../../support.html#support-data-compute-team"><span class="std std-ref">Data and Computation Team</span></a> if you need support.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./guides/data_guides"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../data_guide.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Data Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="cloud_tools.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Working with Cloud Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-a-workflow">Selecting a Workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-a-final-destination-osn-vs-gcs">Choosing a final destination - OSN vs GCS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-upload-pushing-vs-pulling">Manual Upload - “pushing” vs “pulling”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-scenarios">Transfer scenarios</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-jupyter-hub-to-gcs">Move data from Jupyter-Hub to GCS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-jupyter-hub-to-osn">Move data from Jupyter-Hub to OSN</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#move-data-from-laptop-hpc-to-osn">Move data from Laptop/HPC to OSN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#available-tooling">Available Tooling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#osn-pod-ingestion">OSN Pod Ingestion</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By LEAP Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>